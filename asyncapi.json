{
  "asyncapi": "3.0.0",
  "info": {
    "title": "Curator API",
    "version": "1.2.0"
  },
  "channels": {
    "wsChannel": {
      "address": "/ws",
      "description": "WebSocket endpoint used for Curator realtime messaging",
      "messages": {
        "BatchesList": {
          "$ref": "#/components/messages/BatchesList"
        },
        "BatchUploadsList": {
          "$ref": "#/components/messages/BatchUploadsList"
        },
        "CollectionImages": {
          "$ref": "#/components/messages/CollectionImages"
        },
        "Error": {
          "$ref": "#/components/messages/Error"
        },
        "FetchBatches": {
          "$ref": "#/components/messages/FetchBatches"
        },
        "FetchBatchUploads": {
          "$ref": "#/components/messages/FetchBatchUploads"
        },
        "FetchImages": {
          "$ref": "#/components/messages/FetchImages"
        },
        "RetryUploads": {
          "$ref": "#/components/messages/RetryUploads"
        },
        "SubscribeBatch": {
          "$ref": "#/components/messages/SubscribeBatch"
        },
        "SubscribeBatchesList": {
          "$ref": "#/components/messages/SubscribeBatchesList"
        },
        "Subscribed": {
          "$ref": "#/components/messages/Subscribed"
        },
        "UnsubscribeBatch": {
          "$ref": "#/components/messages/UnsubscribeBatch"
        },
        "UnsubscribeBatchesList": {
          "$ref": "#/components/messages/UnsubscribeBatchesList"
        },
        "Upload": {
          "$ref": "#/components/messages/Upload"
        },
        "UploadsComplete": {
          "$ref": "#/components/messages/UploadsComplete"
        },
        "UploadCreated": {
          "$ref": "#/components/messages/UploadCreated"
        },
        "UploadsUpdate": {
          "$ref": "#/components/messages/UploadsUpdate"
        }
      }
    }
  },
  "operations": {
    "ClientMessage": {
      "action": "receive",
      "channel": {
        "$ref": "#/channels/wsChannel"
      },
      "messages": [
        {
          "$ref": "#/channels/wsChannel/messages/FetchBatches"
        },
        {
          "$ref": "#/channels/wsChannel/messages/FetchBatchUploads"
        },
        {
          "$ref": "#/channels/wsChannel/messages/FetchImages"
        },
        {
          "$ref": "#/channels/wsChannel/messages/RetryUploads"
        },
        {
          "$ref": "#/channels/wsChannel/messages/SubscribeBatch"
        },
        {
          "$ref": "#/channels/wsChannel/messages/SubscribeBatchesList"
        },
        {
          "$ref": "#/channels/wsChannel/messages/UnsubscribeBatch"
        },
        {
          "$ref": "#/channels/wsChannel/messages/UnsubscribeBatchesList"
        },
        {
          "$ref": "#/channels/wsChannel/messages/Upload"
        }
      ]
    },
    "ServerMessage": {
      "action": "send",
      "channel": {
        "$ref": "#/channels/wsChannel"
      },
      "messages": [
        {
          "$ref": "#/channels/wsChannel/messages/BatchesList"
        },
        {
          "$ref": "#/channels/wsChannel/messages/BatchUploadsList"
        },
        {
          "$ref": "#/channels/wsChannel/messages/CollectionImages"
        },
        {
          "$ref": "#/channels/wsChannel/messages/Error"
        },
        {
          "$ref": "#/channels/wsChannel/messages/Subscribed"
        },
        {
          "$ref": "#/channels/wsChannel/messages/UploadCreated"
        },
        {
          "$ref": "#/channels/wsChannel/messages/UploadsComplete"
        },
        {
          "$ref": "#/channels/wsChannel/messages/UploadsUpdate"
        }
      ]
    }
  },
  "components": {
    "messages": {
      "BatchesList": {
        "payload": {
          "$ref": "#/components/schemas/BatchesList"
        }
      },
      "BatchUploadsList": {
        "payload": {
          "$ref": "#/components/schemas/BatchUploadsList"
        }
      },
      "CollectionImages": {
        "payload": {
          "$ref": "#/components/schemas/CollectionImages"
        }
      },
      "Error": {
        "payload": {
          "$ref": "#/components/schemas/Error"
        }
      },
      "FetchBatches": {
        "payload": {
          "$ref": "#/components/schemas/FetchBatches"
        }
      },
      "FetchBatchUploads": {
        "payload": {
          "$ref": "#/components/schemas/FetchBatchUploads"
        }
      },
      "FetchImages": {
        "payload": {
          "$ref": "#/components/schemas/FetchImages"
        }
      },
      "RetryUploads": {
        "payload": {
          "$ref": "#/components/schemas/RetryUploads"
        }
      },
      "SubscribeBatch": {
        "payload": {
          "$ref": "#/components/schemas/SubscribeBatch"
        }
      },
      "SubscribeBatchesList": {
        "payload": {
          "$ref": "#/components/schemas/SubscribeBatchesList"
        }
      },
      "Subscribed": {
        "payload": {
          "$ref": "#/components/schemas/Subscribed"
        }
      },
      "UnsubscribeBatch": {
        "payload": {
          "$ref": "#/components/schemas/UnsubscribeBatch"
        }
      },
      "UnsubscribeBatchesList": {
        "payload": {
          "$ref": "#/components/schemas/UnsubscribeBatchesList"
        }
      },
      "Upload": {
        "payload": {
          "$ref": "#/components/schemas/Upload"
        }
      },
      "UploadCreated": {
        "payload": {
          "$ref": "#/components/schemas/UploadCreated"
        }
      },
      "UploadsComplete": {
        "payload": {
          "$ref": "#/components/schemas/UploadsComplete"
        }
      },
      "UploadsUpdate": {
        "payload": {
          "$ref": "#/components/schemas/UploadsUpdate"
        }
      }
    },
    "schemas": {
      "BatchesList": {
        "type": "object",
        "required": [
          "data",
          "partial",
          "type"
        ],
        "properties": {
          "data": {
            "$ref": "#/components/schemas/BatchesListData"
          },
          "partial": {
            "type": "boolean"
          },
          "type": {
            "const": "BATCHES_LIST"
          }
        },
        "additionalProperties": false
      },
      "BatchesListData": {
        "type": "object",
        "required": [
          "items",
          "total"
        ],
        "properties": {
          "items": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/BatchItem"
            }
          },
          "total": {
            "type": "integer"
          }
        },
        "additionalProperties": false
      },
      "BatchItem": {
        "type": "object",
        "required": [
          "id",
          "created_at",
          "username",
          "userid",
          "stats"
        ],
        "properties": {
          "id": {
            "type": "integer"
          },
          "created_at": {
            "type": "string",
            "format": "date-time"
          },
          "username": {
            "type": "string"
          },
          "userid": {
            "type": "string"
          },
          "stats": {
            "$ref": "#/components/schemas/BatchStats"
          }
        },
        "additionalProperties": false
      },
      "BatchStats": {
        "type": "object",
        "required": [
          "completed",
          "duplicate",
          "failed",
          "in_progress",
          "queued",
          "total"
        ],
        "properties": {
          "completed": {
            "type": "integer",
            "default": 0
          },
          "duplicate": {
            "type": "integer",
            "default": 0
          },
          "failed": {
            "type": "integer",
            "default": 0
          },
          "in_progress": {
            "type": "integer",
            "default": 0
          },
          "queued": {
            "type": "integer",
            "default": 0
          },
          "total": {
            "type": "integer",
            "default": 0
          }
        },
        "additionalProperties": false
      },
      "CollectionImagesData": {
        "type": "object",
        "required": [
          "images",
          "creator"
        ],
        "properties": {
          "images": {
            "type": "object",
            "additionalProperties": {
              "$ref": "#/components/schemas/MediaImage"
            }
          },
          "creator": {
            "$ref": "#/components/schemas/Creator"
          }
        },
        "additionalProperties": false
      },
      "BatchUploadItem": {
        "type": "object",
        "required": [
          "id",
          "status",
          "filename",
          "wikitext"
        ],
        "properties": {
          "id": {
            "type": "integer"
          },
          "status": {
            "type": "string"
          },
          "filename": {
            "type": "string"
          },
          "wikitext": {
            "type": "string"
          },
          "batchid": {
            "type": "integer"
          },
          "userid": {
            "type": "string"
          },
          "key": {
            "type": "string"
          },
          "handler": {
            "type": "string"
          },
          "sdc": {
            "type": "array",
            "items": {
              "$ref": "sdc.json#/components/schemas/Statement"
            }
          },
          "labels": {
            "$ref": "#/components/schemas/Label"
          },
          "result": {
            "type": "string"
          },
          "error": {
            "$ref": "#/components/schemas/StructuredError"
          },
          "success": {
            "type": "string"
          },
          "created_at": {
            "type": "string",
            "format": "date-time"
          },
          "updated_at": {
            "type": "string",
            "format": "date-time"
          },
          "image_id": {
            "type": "string"
          }
        },
        "additionalProperties": false
      },
      "BatchUploadsList": {
        "type": "object",
        "required": [
          "data",
          "type"
        ],
        "properties": {
          "data": {
            "$ref": "#/components/schemas/BatchUploadsListData"
          },
          "type": {
            "const": "BATCH_UPLOADS_LIST"
          }
        },
        "additionalProperties": false
      },
      "BatchUploadsListData": {
        "type": "object",
        "required": [
          "batch",
          "uploads"
        ],
        "properties": {
          "batch": {
            "$ref": "#/components/schemas/BatchItem"
          },
          "uploads": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/BatchUploadItem"
            }
          }
        },
        "additionalProperties": false
      },
      "CollectionImages": {
        "type": "object",
        "required": [
          "type",
          "data"
        ],
        "properties": {
          "type": {
            "const": "COLLECTION_IMAGES"
          },
          "data": {
            "$ref": "#/components/schemas/CollectionImagesData"
          }
        },
        "additionalProperties": false
      },
      "Creator": {
        "type": "object",
        "required": [
          "id",
          "username",
          "profile_url"
        ],
        "properties": {
          "id": {
            "type": "string"
          },
          "username": {
            "type": "string"
          },
          "profile_url": {
            "type": "string",
            "format": "uri"
          }
        },
        "additionalProperties": false
      },
      "Dates": {
        "type": "object",
        "required": [
          "taken"
        ],
        "properties": {
          "taken": {
            "type": "string",
            "format": "date-time"
          }
        },
        "additionalProperties": false
      },
      "DuplicateError": {
        "type": "object",
        "required": [
          "links",
          "message"
        ],
        "properties": {
          "links": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/ErrorLink"
            }
          },
          "message": {
            "type": "string"
          },
          "type": {
            "const": "duplicate"
          }
        },
        "additionalProperties": false
      },
      "Error": {
        "type": "object",
        "required": [
          "data",
          "type"
        ],
        "properties": {
          "data": {
            "type": "string",
            "description": "Error data"
          },
          "type": {
            "const": "ERROR"
          }
        },
        "additionalProperties": false
      },
      "ErrorLink": {
        "type": "object",
        "required": [
          "title",
          "url"
        ],
        "properties": {
          "title": {
            "type": "string"
          },
          "url": {
            "type": "string",
            "format": "uri"
          }
        },
        "additionalProperties": false
      },
      "ExistingPage": {
        "type": "object",
        "required": [
          "url"
        ],
        "properties": {
          "url": {
            "type": "string",
            "format": "uri"
          }
        },
        "additionalProperties": false
      },
      "FetchBatches": {
        "type": "object",
        "required": [
          "data",
          "type"
        ],
        "properties": {
          "data": {
            "$ref": "#/components/schemas/FetchBatchesData"
          },
          "type": {
            "const": "FETCH_BATCHES"
          }
        },
        "additionalProperties": false
      },
      "FetchBatchesData": {
        "type": "object",
        "required": [
          "page",
          "limit"
        ],
        "properties": {
          "page": {
            "type": "integer",
            "default": 1,
            "minimum": 1
          },
          "limit": {
            "type": "integer",
            "default": 100,
            "minimum": 1
          },
          "userid": {
            "type": "string",
            "description": "Optional user id to filter batches"
          },
          "filter": {
            "type": "string",
            "description": "Optional filter text for batches (id or username)"
          }
        },
        "additionalProperties": false
      },
      "FetchBatchUploads": {
        "type": "object",
        "required": [
          "data",
          "type"
        ],
        "properties": {
          "data": {
            "type": "integer",
            "description": "Batch identifier"
          },
          "type": {
            "const": "FETCH_BATCH_UPLOADS"
          }
        },
        "additionalProperties": false
      },
      "FetchImages": {
        "type": "object",
        "required": [
          "data",
          "type"
        ],
        "properties": {
          "data": {
            "type": "string",
            "description": "Collection identifier"
          },
          "type": {
            "const": "FETCH_IMAGES"
          }
        },
        "additionalProperties": false
      },
      "GenericError": {
        "type": "object",
        "required": [
          "message"
        ],
        "properties": {
          "message": {
            "type": "string"
          },
          "type": {
            "const": "error"
          }
        },
        "additionalProperties": false
      },
      "GeoLocation": {
        "type": "object",
        "required": [
          "compass_angle",
          "latitude",
          "longitude"
        ],
        "properties": {
          "accuracy": {
            "type": "integer"
          },
          "compass_angle": {
            "type": "number",
            "format": "float"
          },
          "latitude": {
            "type": "number",
            "format": "float"
          },
          "longitude": {
            "type": "number",
            "format": "float"
          }
        },
        "additionalProperties": false
      },
      "Label": {
        "type": "object",
        "required": [
          "language",
          "value"
        ],
        "properties": {
          "language": {
            "type": "string"
          },
          "value": {
            "type": "string"
          }
        },
        "additionalProperties": false
      },
      "MediaImage": {
        "type": "object",
        "required": [
          "creator",
          "dates",
          "existing",
          "height",
          "id",
          "location",
          "preview_url",
          "thumbnail_url",
          "title",
          "url",
          "url_original",
          "width"
        ],
        "properties": {
          "camera_make": {
            "type": "string"
          },
          "camera_model": {
            "type": "string"
          },
          "creator": {
            "$ref": "#/components/schemas/Creator"
          },
          "dates": {
            "$ref": "#/components/schemas/Dates"
          },
          "description": {
            "type": "string"
          },
          "existing": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/ExistingPage"
            }
          },
          "height": {
            "type": "integer"
          },
          "id": {
            "type": "string"
          },
          "is_pano": {
            "type": "boolean"
          },
          "license": {
            "type": "string"
          },
          "location": {
            "$ref": "#/components/schemas/GeoLocation"
          },
          "preview_url": {
            "type": "string",
            "format": "uri"
          },
          "tags": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "thumbnail_url": {
            "type": "string",
            "format": "uri"
          },
          "title": {
            "type": "string"
          },
          "url": {
            "type": "string",
            "format": "uri"
          },
          "url_original": {
            "type": "string",
            "format": "uri"
          },
          "width": {
            "type": "integer"
          }
        },
        "additionalProperties": false
      },
      "RetryUploads": {
        "type": "object",
        "required": [
          "data",
          "type"
        ],
        "properties": {
          "data": {
            "type": "integer",
            "description": "Batch identifier"
          },
          "type": {
            "const": "RETRY_UPLOADS"
          }
        },
        "additionalProperties": false
      },
      "StructuredError": {
        "oneOf": [
          {
            "$ref": "#/components/schemas/DuplicateError"
          },
          {
            "$ref": "#/components/schemas/GenericError"
          },
          {
            "$ref": "#/components/schemas/TitleBlacklistedError"
          }
        ]
      },
      "SubscribeBatch": {
        "type": "object",
        "required": [
          "data",
          "type"
        ],
        "properties": {
          "data": {
            "type": "integer",
            "description": "Batch identifier"
          },
          "type": {
            "const": "SUBSCRIBE_BATCH"
          }
        },
        "additionalProperties": false
      },
      "SubscribeBatchesList": {
        "type": "object",
        "required": [
          "data",
          "type"
        ],
        "properties": {
          "data": {
            "$ref": "#/components/schemas/SubscribeBatchesListData"
          },
          "type": {
            "const": "SUBSCRIBE_BATCHES_LIST"
          }
        },
        "additionalProperties": false
      },
      "SubscribeBatchesListData": {
        "type": "object",
        "properties": {
          "filter": {
            "type": "string",
            "description": "Filter text for batches"
          },
          "userid": {
            "type": "string",
            "description": "User id to filter batches"
          }
        },
        "additionalProperties": false
      },
      "Subscribed": {
        "type": "object",
        "required": [
          "data",
          "type"
        ],
        "properties": {
          "data": {
            "type": "integer",
            "description": "Subscribed batch identifier"
          },
          "type": {
            "const": "SUBSCRIBED"
          }
        },
        "additionalProperties": false
      },
      "TitleBlacklistedError": {
        "type": "object",
        "required": [
          "message"
        ],
        "properties": {
          "message": {
            "type": "string"
          },
          "type": {
            "const": "title_blacklisted"
          }
        },
        "additionalProperties": false
      },
      "UnsubscribeBatch": {
        "type": "object",
        "required": [
          "type"
        ],
        "properties": {
          "type": {
            "const": "UNSUBSCRIBE_BATCH"
          }
        },
        "additionalProperties": false
      },
      "UnsubscribeBatchesList": {
        "type": "object",
        "required": [
          "type"
        ],
        "properties": {
          "type": {
            "const": "UNSUBSCRIBE_BATCHES_LIST"
          }
        },
        "additionalProperties": false
      },
      "Upload": {
        "type": "object",
        "required": [
          "type",
          "data"
        ],
        "properties": {
          "type": {
            "const": "UPLOAD"
          },
          "data": {
            "$ref": "#/components/schemas/UploadData"
          }
        },
        "additionalProperties": false
      },
      "UploadsComplete": {
        "type": "object",
        "required": [
          "data",
          "type"
        ],
        "properties": {
          "data": {
            "type": "integer",
            "description": "Completed batch identifier"
          },
          "type": {
            "const": "UPLOADS_COMPLETE"
          }
        },
        "additionalProperties": false
      },
      "UploadCreatedItem": {
        "type": "object",
        "required": [
          "id",
          "status",
          "image_id",
          "input",
          "batchid"
        ],
        "properties": {
          "id": {
            "type": "integer"
          },
          "status": {
            "type": "string"
          },
          "image_id": {
            "type": "string"
          },
          "input": {
            "type": "string"
          },
          "batchid": {
            "type": "integer"
          }
        },
        "additionalProperties": false
      },
      "UploadCreated": {
        "type": "object",
        "required": [
          "type",
          "data"
        ],
        "properties": {
          "type": {
            "const": "UPLOAD_CREATED"
          },
          "data": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/UploadCreatedItem"
            }
          }
        },
        "additionalProperties": false
      },
      "UploadData": {
        "type": "object",
        "required": [
          "items",
          "handler"
        ],
        "properties": {
          "items": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/UploadItem"
            }
          },
          "handler": {
            "type": "string",
            "default": "mapillary"
          }
        },
        "additionalProperties": false
      },
      "UploadItem": {
        "type": "object",
        "required": [
          "id",
          "input",
          "title",
          "wikitext"
        ],
        "properties": {
          "id": {
            "type": "string"
          },
          "input": {
            "type": "string"
          },
          "title": {
            "type": "string"
          },
          "wikitext": {
            "type": "string"
          },
          "labels": {
            "$ref": "#/components/schemas/Label"
          },
          "sdc": {
            "type": "array",
            "items": {
              "$ref": "sdc.json#/components/schemas/Statement"
            }
          }
        },
        "additionalProperties": false
      },
      "UploadsUpdate": {
        "type": "object",
        "required": [
          "type",
          "data"
        ],
        "properties": {
          "type": {
            "const": "UPLOADS_UPDATE"
          },
          "data": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/UploadUpdateItem"
            }
          }
        },
        "additionalProperties": false
      },
      "UploadUpdateItem": {
        "type": "object",
        "required": [
          "id",
          "batchid",
          "status",
          "key",
          "handler"
        ],
        "properties": {
          "id": {
            "type": "integer"
          },
          "batchid": {
            "type": "integer"
          },
          "status": {
            "type": "string"
          },
          "key": {
            "type": "string"
          },
          "error": {
            "$ref": "#/components/schemas/StructuredError"
          },
          "success": {
            "type": "string"
          },
          "handler": {
            "type": "string"
          }
        },
        "additionalProperties": false
      }
    }
  }
}
